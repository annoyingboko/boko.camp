{%- assign _excerpt_truncate = include.excerpt_truncate | default: 350 -%}

{%- assign _excerpt_type = include.excerpt_type | default: site.data.variables.default.excerpt_type  -%}

{%- assign _sorted_list = include.articles -%}
{%- if include.group_by == 'year' -%}
  {%- assign _sorted_list = _sorted_list | sort: 'date' -%}
{%- endif -%}
{%- if include.reverse -%}
  {%- assign _sorted_list = _sorted_list | reverse -%}
{%- endif -%}

{%- if include.type == 'common' -%}
<div class="article-list--common">
{%- elsif include.type == 'brief' -%}
<div class="article-list--brief">
{%- endif -%}

  {%- for _article in _sorted_list -%}

    {%- include snippets/prepend-baseurl.html path=_article.url -%}
    {%- assign _href = __return -%}

    {%- include snippets/locale-to-string.html locale=site.data.locale.READMORE -%}
    {%- assign _locale_readmore = __return -%}

    {%- if include.type == 'common' -%}

      <article itemscope itemtype="http://schema.org/BlogPosting">
        <header class="article__header"><h2 itemprop="headline"><a href="{{ _href }}">{{ _article.title }}</a></h2></header>
        {%- if _article.excerpt and include.show_excerpt -%}
          <div class="article__content" itemprop="description articleBody">
            {%- if _excerpt_type == 'html' -%}
              {{ _article.excerpt }}
            {%- else -%}
              {{ _article.excerpt | strip_html | truncate: _excerpt_truncate }}
            {%- endif -%}
          </div>
        {%- endif -%}
        <p class="readmore"><a href="{{ _href }}">{{ _locale_readmore }}</a></p>
        {%- include article-info.html article=_article show_pageview=true -%}
      </article>


    {%- elsif include.type == 'brief' -%}
      {%- assign _tags = '' -%}
      {%- for _tag in _article.tags -%}
        {%- assign _tag_encode = _tag | strip | url_encode } -%}
        {%- if forloop.last -%}
          {%- assign _tags = _tags | append: _tag_encode -%}
        {%- else -%}
          {%- assign _tags = _tags | append: _tag_encode | append: ',' -%}
        {%- endif -%}
      {%- endfor -%}
      {%- include snippets/locale-to-string.html locale=site.data.locale.ARTICLE_DATE_FORMAT -%}
      {%- if include.group_by == 'year' -%}
        {%- assign _currentdate = _article.date | date: '%Y' -%}
        {%- if _currentdate != _date -%}
          {%- unless forloop.first -%}</section>{%- endunless -%}
          <section><h2 class="group">{{ _currentdate }}</h2>
          {%- assign _date = _currentdate -%}
        {%- endif -%}
      {%- endif -%}
      <article itemscope itemtype="http://schema.org/BlogPosting" data-tags="{{ _tags }}">
        <span class="date">{{ _article.date | date: __return }}</span><a itemprop="headline" class="title" href="{{ _href }}">{{ _article.title }}</a>
        <meta itemprop="datePublished" content="{{ include.article.date | date_to_xmlschema }}">
      </article>
    {%- endif -%}

  {%- endfor -%}
</div>